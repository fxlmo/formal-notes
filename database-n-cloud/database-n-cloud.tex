%%=====================================================================================
%%
%%       Filename:  database-n-cloud.tex
%%
%%    Description:  Notes for database and cloud written up nicely
%%
%%        Version:  1.0
%%        Created:  06/04/19
%%       Revision:  none
%%
%%         Author:  Josh Felmeden (), nk18044@bristol.ac.uk
%%   Organization:  
%%      Copyright:  Copyright (c) 2019, Josh Felmeden
%%
%%          Notes:  
%%
%%=====================================================================================

% Preamble
\documentclass[11pt,a4paper,titlepage,dvipsnames,cmyk]{scrartcl}
\usepackage[english]{babel}
\typearea{12}

% Set indentation and line skip for paragraph
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}
\usepackage[margin=2cm]{geometry}
\addtolength{\textheight}{-1in}
\setlength{\headsep}{.5in}

\usepackage{hhline} 
\usepackage{mathtools} 
\usepackage[T1]{fontenc}

% Headers setup
\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{Databases and the Cloud: The notes}
\rhead{Josh Felmeden}
\usepackage{hyperref} 
\usepackage{mathtools} 


% Listings
\usepackage[]{listings,xcolor} 
\lstset
{
    breaklines=true,
    tabsize=3,
    showstringspaces=false
}

\definecolor{lstgrey}{rgb}{0.05,0.05,0.05}
\usepackage{listings}
\makeatletter
\lstset{language=HTML,
    backgroundcolor=\color{lstgrey},
    frame=single,
    xleftmargin=0.7cm,
    frame=tlbr, framesep=0.2cm, framerule=0pt,
    basicstyle=\lst@ifdisplaystyle\color{white}\footnotesize\ttfamily\else\color{black}\footnotesize\ttfamily\fi,
    captionpos=b,
    tabsize=2,
    keywordstyle=\color{Magenta}\bfseries,
    identifierstyle=\color{Cyan},
stringstyle=\lst@ifdisplaystyle\color{Yellow}\else\color{Green}\fi,
    commentstyle=\color{Gray}\itshape
}
\makeatother

% Other packages
\usepackage{needspace}
\usepackage{tcolorbox}
\usepackage{soul}
\usepackage{babel,dejavu,helvet} 
\usepackage[]{amsmath} 
\usepackage[]{booktabs} 
\usepackage[symbol]{footmisc} 
\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\renewcommand{\familydefault}{\sfdefault}

% Title
\title{Databases and the Cloud: The Notes}
\date{2018\\ December}
\author{Josh Felmeden}

% Start document
\begin{document}
\pagenumbering{roman}
\maketitle

\tableofcontents
\newpage
\pagenumbering{arabic}

\section{The Internet}%
\label{sec:The Internet}
End systems are connected via the \textbf{communication links} that
consist of the different types of physical media. Usually, the end systems
are not directly attached by a single link, but rather they are attached
through a router.

There are two kinds of host: \textit{clients} and \textit{servers}. A
program or machine that responds to request and others is called a
\textbf{server} while a program or machine that sends the requests to the
server is called a \textbf{client}.

The internet is made possible by the development, testing, and
implementation of the \textit{internet standards}. They are developed by
the Internet Engineering Task Force (or the IETF). Their documents are
known as RFCs (request for comments). There are a number of protocols,
such as TCP, IP, HTTP, and SMTP (this one is used for emails). There are
more than 2000 RFCs.

\subsection{Protocols}%
\label{sub:Protocols}
A \textbf{protocol} is a set of rules that govern the communication to
ensure a standard of communication. It also consists of messages sent and
actions taken in response to replies or other such events.

A simple protocol could be where one machine sends a message (called a
\textit{request}) and another machine replies with a response. This can
then be repeated.

\subsection{Internet Layers}%
\label{sub:internet-layers}
\begin{itemize}
    \item HTTP
    \begin{itemize}
        \item Makes request
        \item Reads and handles the response
    \end{itemize}
    \item TCP
        \begin{itemize}
            \item Breaks data up into packets
            \item Puts the packets back in order and reassembles messages
        \end{itemize}
    \item IP
        \begin{itemize}
            \item Attaches to and from addresses to each packet
            \item Reads and groups packets based on the address
        \end{itemize}
    \item Physical internet
    \begin{itemize}
        \item Send bits to local routers
        \item Receives bits and assembles into packets
    \end{itemize}
\end{itemize}

\subsection{HTTP: Hyper text transfer protocol}%
\label{sub:http}
What's the difference between the web and the internet? Well, the internet
is the computer network itself (or the whole infrastructure): while the
web (or the world wide web) is an application that runs on that
infrastructure.

It's probably the most common application protocol that there is on the
web (but there are others like video streaming and FTP and the like).
Right now, there's a version 2.0, but we'll be focussing on version 1.1
here.

\subsection{Crud}%
\label{sub:Crud}
CRUD is an acronym for the basic operations that can be carried out on
data.

\begin{itemize}
    \item Create
    \begin{itemize}
        \item The create interaction creates a new resource in a server
            assigned location. The create interaction is performed by a
            HTTP POST method.
    \end{itemize}
    \item Read
    \begin{itemize}
        \item The read interaction accesses the current contents of a
            resource. The interaction is performed by a HTTP GET method
    \end{itemize}
    \item Update
    \begin{itemize}
        \item The update interaction makes a whole new version for an
            existing resource (or makes a new one if there isn't one)
    \end{itemize}
    \item Delete
    \begin{itemize}
        \item The delete interaction deletes an existing resource
    \end{itemize}
\end{itemize}

\subsection{Structure}%
\label{sub:Structure}
HTTP is \textit{line-based} and each line ends with a \textbf{carriage
return line feed} (CR LF). In it, there is a header and a method.

\subsection{Status codes}%
\label{sub:Status codes}
There are some cases where an interaction does not go well. The response
from a server can be a number, and the first digit informs you of the
nature of the error.

\subsection{URLs}%
\label{sub:URLs}
The internet needs to have addresses. It needs to know the addresses of
both the client and the server. The URL (\textbf{uniform resource
locator}) tells you where some resource is. A resource is an
\textit{address}.

\section{Developing web pages}%
\label{sec:web-pages}

\subsection{Markup}%
\label{sub:Markup}
Historically, marking up a paper manuscript was done by editors to show
authors how to revise their manuscripts. The markup was done in
\textit{blue pen} to make it distinguishable from the manuscript text.

In electronic documents, \textbf{tags} are used to make the markup
distinguishable from the content. A markup language is used to annotate a
document.

\subsection{HTML}%
\label{sub:HTML}
HTML (or hypertext markup language) consists of a fixed set of
\textit{tags} that describe how information should be displayed. For
example:
\begin{lstlisting}
<p> This is some text </p>
<h1> This is some header </h1>
\end{lstlisting}

The Browsers do not display the HTML tags, but they use them to render the
content of the page.

HTML5 is different from HTML because it's simpler, but also \textbf{semantic}
(which means that some of the tags describe what the data means as well
has how it should be displayed). It also has some more features.

Example HTML5:
\begin{lstlisting}[]
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>My title</title>
    </head>
    <body>
        content
    </body>
</html>
\end{lstlisting}

Tags have to be nested too.

A block-level element always starts on a new line and takes up the full
width available. Conversely, an inline element doesn't start on a new line
and it only takes up as much width as is necessary.

The \lstinline{<div>} tag is a block level tag that has no specific
meaning. This is OK to use for layout purposes, but you should not use it
as a replacement for something that should be a semantic tag. Because the
semantic tags are mostly a new addition to HTML5, older frameworks used
\lstinline{<div>} all over the place to structure the pages.

\subsubsection{Attributes}%
\label{ssub:Attributes}
In this example:
\begin{lstlisting}[]
<p id="today">
    28 September
</p>
<p class="info">
    lecture 2
</p>
<p class="info">
    QB 0.18
</p>
\end{lstlisting}

\subsubsection{Links}%
\label{ssub:Links}
Almost anything can go inside a \lstinline{<a>} tag: text, images, other
HTML elements. The href could be a full URL, or it can be relative to the
current page.

The main issue with HTML is that you need to structure your web pages
really carefully because it's going to be viewed on all kinds of devices
and browsers.

Here are some basic rules:
\begin{enumerate}
    \item Use lower case element names
    \item Close all your elements (you don't need to close them in HTML5
        but do it anyway)
    \item In HTML5, it's optional to close the empty statements, but do it
        anyway.
    \item HTML5 allows the mixing of uppercase and lowercase names, but
        just use lowercase because it looks nicer and it's easier to
        write.
    \item HTML5 allows attribute values without quotes but again, it's bad
        because it looks ugly
    \item ALWAYS add the \lstinline{alt} attribute to images, because if,
        for some reason, the image can't be displayed, you need some
        alternate text to display. It's also used for people using screen
        readers.
    \item In HTML5, the \lstinline{html} and \lstinline{body} tag can be
        omitted, but, again, it's \textbf{bad}. It can crash some XML
        software.
    \item To ensure that everything is interpreted and has correct search
        engine indexing, the language AND the character encoding should be
        defined as early as possible.
    \item Don't use absolute pixel width measurements
\end{enumerate}

\subsection{Forms}%
\label{sub:Forms}
The form tag is used for things like buttons, text boxes, etc. It has
input types of things like:
\begin{itemize}
    \item Button
    \item Month
    \item Number
    \item Text
    \item Password
    \item Color
    \item Date
    \item ...
\end{itemize}

The \textbf{action} attribute defines the action to be performed when the
form is submitted. Normally, the data from the form is sent to a web page
on the server when the user clicks on the submit button. For example:

\begin{lstlisting}
<form method="post"
action="/action_page.php">
</form>
\end{lstlisting}

In this example, the data is sent to a page on the server called
\lstinline{"/action_page.php"}. This page contains a script that will
handle the form data such as storing it in a database.

There are two (2) methods to send form data, \textbf{GET} and
\textbf{POST}. In HTML5, browser forms support them both. GET places form
data in the URL parameters by default (GET/search?query=pancakes), while
POST sends the data in the HTTP request body. There are fewer limitations
and it's more secure because the data is not visible in the URL.

\subsubsection{Validation in forms}%
\label{ssub:form-validation}
If you use \lstinline{type="number"}, then it won't let you type in
letters. It you use \lstinline{required}, then the browser won't let you
submit if the field is empty.

Place holder is text that can be displayed while the field is empty. It's
NOT a label.

\subsubsection{Buttons}%
\label{ssub:Buttons}
Buttons can have these types:
\begin{itemize}
    \item Submit (default)
    \item Reset: reset all form fields
    \item Button: do nothing by default (use this if you're using JS).
\end{itemize}

\subsection{CSS}%
\label{sub:CSS}
Use HTML for the structure, and then CSS for the styling. This includes
layout, appearance, and some behaviours. You can customise ANYTHING. If
you want emphasised words to be underlined, then by golly you can do that.

CSS stands for Cascading Style Sheets. CSS describes how HTML elements are
to be displayed on screen. CSS saves a lot of work. It can control the
layout of a number of multiple web pages all at once. It can be added to
HTML elements in 3 ways

\begin{itemize}
    \item \textbf{Inline} which means that it uses the style attribute in
        HTML elements
    \item \textbf{Internal} which means tat it uses a \lstinline{<style>}
        element in the \lstinline{<head>} section.
    \item \textbf{External} which means that it links to a CSS file. This
        is the recommended method btw. 
\end{itemize}

Linking to a stylesheet looks something like this:

\begin{lstlisting}[]
<link rel="stylesheet" href="styles.css">
\end{lstlisting}

This goes in the head tag of any web page. External style sheets have a
few advantages, namely that a single style sheet can control a lot of
pages. In general, you have a number of different pages that share a
common style. You can define the style sheet in a single document and then
have all of the HTML files refer to the same CSS file. It also facilitates
\textit{global changes} because if you're using external styles, you make
a change in one place and then it's automatically propagated to all of the
pages in the system. Finally, it allows for the \textit{separation} of
content and design. With the external CSS, all of the design is housed in
the CSS and the data is in HTML.

Oh, also note that there are two kinds of reference: absolute (for example
the absolute reference of a page like
\lstinline{href="http://www.example.com/theme.css"}) while the relative
looks like \lstinline{href="/themes/theme.css"}.

\begin{minipage}{\textwidth}
Here's an example of a style sheet:
\begin{lstlisting}[]
h1 {
    font-family: sans-serif;
}

.lecture {
    font-weight: bold;
}

em { font-style: normal; }
em.room { font-style: italic; }
\end{lstlisting}
\end{minipage}

\subsection{Data Formats and Operations}%
\label{sub:Data Formats and Operations}
In 2015, Bristol elected a councillor for each of the 24 wards. Here are
the results for this:
\begin{center}
    \begin{tabular}{|c|c|c|}
        \hline
        \textbf{Candidate} & \textbf{Party} & \textbf{Votes} \\
        \hline
        Chris Davies & Liberal Democrat & 2435 \\
        \hline
        Christopher Louis Orlik & Labour & 1499 \\
        \hline
        Glenn Royston Vowles & Green & 722 \\
        \hline
        Claire Lisa Louise Hayes & Uk Independence & 625 \\
        \hline
        Anthony Paul Lee & Conservative & 590 \\
        \hline
        Domenico Hill & Trade Unionists and Socialist Coalition & 37 \\
        \hline
    \end{tabular}
\end{center}

Here's what the structure would look like if it was written in C:
\begin{lstlisting}[language=c]
struct Candidate {
    char  name[100];
    char party[100];
};

struct Ward {
    char name[100];
    int electorate;
};

struct Result {
    struct Candidate candidate;
    struct Ward ward;
    int votes;
};
\end{lstlisting}

\begin{minipage}{\textwidth}
Here's how it would look in Java:
\begin{lstlisting}[language=java]
class Candidate {
    String  name;
    String party;
};

class Ward {
    String name;
    int electorate;
};

class Result {
    Candidate candidate;
    Ward ward;
    int votes;
};
\end{lstlisting}
\end{minipage}

And here's how we use the data structures
\begin{lstlisting}[]
winner.candidate.name = "Chris Davies";
winner.candidate.party = "Liberal Democrat";
winner.ward.name = "Knowle";
winner.ward.electorate = 8820;
winner.votes = 2435;

System.out.println("In " + winner.ward.name + ", the winner was " +
winner.candidate.name + " with " + winner.votes + " votes.");

>> "In Knowle, the winner was Chris Davies with 8820 votes."
\end{lstlisting}

The question now is: How do we read data from storage? Well, what we
shouldn't do is create our own data format (unless you're a big boy like
Google/Microsoft). What we should do is to use the existing standards for
encoding and storing data.

\subsubsection{UNICODE and Encoding}%
\label{ssub:unicode}
Every file is a sequence of bytes that can further be broken down into
bits. What the bytes mean are entirely dependent on how the are encoded
and what sort of file type it is. 1 byte means that there are 256
possibilities. This is more than enough for most Western languages, but
the stupid Chinese have something like 50k characters depending on how you
count them. We also might want to encode more than the alphanumeric
characters like icons, emojis, line drawing chars, mathematical symbols
and so on.

ASCII was invented in the early 60's as a standard character set for
computers and electronic devices. It's a 7-bit set containing 128 chars.
It contains all of the English alphanumeric characters and some special
characters. Unfortunately, once a lot more countries got involved in the
internet, we needed a few more characters to allow us to represent their
languages and alphabets. This is where Unicode came in.

\begin{minipage}{\textwidth}
The Unicode Consortium develops their Unicode standard. It replaces the
existing character sets (ASCII) with a new one that is then implemented in
many language such as HTML, XML, Java, and even the Latex I'm writing this
in. Unicode defines a crazy 136k characters. \textbf{Encoding} is how
these numbers are translated into binary numbers to be stored and
processed in a computer. There are different ways that Unicode characters
or code points can be encoded. There are some fixed width and some
variable length encodings.
\end{minipage}

Line endings are kind of complicated, because in UNIX based devices, the
ending is written as `LF', or, in binary, `0000 1010'. However, in early
mac, it's written as `CR', or, in binary, `0000 1101'. Some systems even
use a combination of the two.

Some network protocols have fixed conventions. For example, HTTP
uses ASCII and defines a line ending as CRLF.

\subsubsection{Tables and CSV}%
\label{ssub:tables}
The simplest `structured' file format is a list file with one entry per
line. We can read or write to this in a loop. \textit{Tables} are for
2-dimensional data. Another option we have is a CSV, or \textbf{comma
separated values}. This might look like:

\begin{lstlisting}[]
Candidate, Party, Votes
Chris Davies, Liberal Democrat, 2435
...
\end{lstlisting}

\subsubsection{Stream Processing}%
\label{ssub:stream}
In a stream, data items arrive one at a time and you only get to see them
once each. We can use these streams if processing can be done with a
single pass over the data, or if we only need to access recent data. We
cannot do stream processing if we nee to do multiple passes through a data
set or we need random access to items in the data set.

There are a few stream operations: filter, map, and reduce.

\textbf{Filter} means the we only read certain values that matches some
condition.

\textbf{Maps} apply a function to each of the data items that are received
through a stream.

\textbf{Reduce} applies a function to the whole stream and then output a
single output.

We can also chain these operations.

Streams are really important because when we develop data driven web apps,
we often need to process these streams of data, and if we bear these in
mind when we write the code, we can structure it accordingly. \textit{Map}
and \textit{filter} are stateless, per-element tasks. They are easy to
parallelise. Some \textit{reduce} operations can be done in parallel too. 

\subsection{Representing Data as Trees}%
\label{sub:tree-data}
If a list is 1-dimensional, and a table is 2-dimensional, what on earth is
a 3-dimensional data? Actually, it's pretty easy, we just pick a third
separator character.

Tree structure (or tree diagram) is a way of representing the hierarchical
structure of data. It's called tree structure because it resembles a tree
(duh doi) even though the diagram is generally upside down compared to a
tree. The top most level is called the \textbf{root} while the bottom most
ones are called the \textbf{leaves}.

\begin{minipage}{\textwidth}
Interestingly, most data can be represented as a tree. If we look at the
candidate class from above:

\begin{lstlisting}[language=XML]
<candidate>
    <name>Catherine Slade</name>
    <party>
        <name>Green</name>
    </party>
    <ward>
        <name>Bedminster></name>
        <electorate>9951</electorate>
    </ward>
</candidate>
\end{lstlisting}
\end{minipage}

Another way to represent this might be:

\begin{lstlisting}[]
{
    "name":"Catherine Slade",
    "party": {"name:": "Green"},
    "ward": {"name": "Bedminster", "electorate": 9951},
}
\end{lstlisting}

Escape characters are used to signify that a character sequence needs to
get special treatment from the same characters. Here are some now:

\begin{itemize}
    \item \textbackslash n is a line feed
    \item \textbackslash r is a carriage return
    \item \textbackslash \textbackslash \text{ }is a back slash
    \item \textbackslash " is a double quote.
\end{itemize}

\subsubsection{XML}%
\label{ssub:XML}

XML is pretty straightforward to use all over the internet. It's also easy
to write programs that process the XML documents.

HTML is all about displaying the information, while XML \textbf{describes}
information. XML is the most common tool for data manipulation and data
transmission. It can also be used for data storage. XML is both human AND
machine readable, while also being flexible enough to support platform and
architecture independent data interchange. XML allows a software engineer
to create a vocabulary and use it to describe data (also sometime called
being an \textbf{extensible} language).

The properties of XML include:
\begin{itemize}
    \item Information identification
    \item Information storage
    \item Portable and non-proprietary
    \item Data transfer
\end{itemize}

The components of XML are:

\begin{itemize}
    \item The declaration
    \item The root element
    \item Attributes
    \item Child elements
    \item Text data
\end{itemize}

In XML there are different steps for validation and processing. There are
a total of 2 validation methods. The first is called DTD, or
\textbf{Document Type Definition}. The other is called \textbf{schema}.

Here is an example of how this works;

Example XML:
\begin{lstlisting}[language=XML]
<candidate>
    <name>Catherine Slade</name>
    <party>
        <name>Green</name>
    </party>
    <ward>
        <name>Bedminster></name>
        <electorate>9951</electorate>
    </ward>
</candidate>
\end{lstlisting}

DTD validation:
\begin{lstlisting}[]
<?xml version="1.0"?>
<!DOCTYPE candidate [
<!ELEMENT candidate (name, party, ward)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT party (name)>
<!ELEMENT ward (name, electorate)>
<!ELEMENT electorate (#PCDATA)>
]>
<candidate> ... </candidate>
\end{lstlisting}

XML schema are another way of describing and XML document structure in XML
itself. Nuts, right? Schemas are \textit{more powerful} than DTDs. Also,
an \textbf{XSD} is an \textbf{XML schema definition}.

\begin{minipage}{\textwidth}
Example schema:
\begin{lstlisting}[language=XML]
<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="candidate">
        <xs:complexType> <xs:sequence>
    <xs:element name="name"type="xs:string"/>
    <xs:element name="party"> <xs:complexType> <xs:sequence>
        <xs:element name="name"type="xs:string"/>
    </xs:sequence> </xs:complexType> </xs:element>
        <xs:element name="ward"> <xs:complexType> <xs:sequence>
            <xs:element name="name "type="xs:string"/>
            <xs:element name="electorate"
                        type="xs:nonNegativeInteger"/>
        </xs:sequence> </xs:complexType> </xs:element>
    </xs:sequence> </xs:complexType> </xs:element>
</xs:schema>
\end{lstlisting}
\end{minipage}

\textbf{XML entities} are kinda like escape sequences, and they're also
used in HTML. For example, there are:
\begin{itemize}
    \item $<$ is written by \& lt;
    \item $>$ is written by \& gt;
    \item " is written by \& quot;
\end{itemize}

\textbf{XPath/XQuery} are ways in which to address nodes in an XML
document. This also works for non-XML versions of HTML and can be very
useful in web applications. They're kinda like CSS selectors but have a
different syntax.

The final thing to worry about with XML is the XSLT. This stupid acronym
means \textit{eXtensible Stylesheet Transformation Language} and it's used
for transforming XML documents into other documents, such as HTML, PDFs,
and even back into XML documents.

\subsubsection{JSON}%
\label{ssub:JSON}
JSON (or JavaScript Object Notation) is a widely used data format for web
apps. It is text, so it can be used to exchange data between a server and
it's client browser. On top of that, it's also easily human readable and
writable. Because of the fact that it's text, it can be parsed and
generated by the majority of programming languages. Neato!

JSON syntax is derived from JavaScript syntax, such as the Data is in the
format of name/value pairs. Also, data is separated by commas. Curly
braces hold objects, and square brackets hold arrays.

\begin{minipage}{\textwidth}
Here's an example of some JSON:
\begin{lstlisting}[]
{   
    "name:" "David",
    "id": 101,
    "units":
    ["COMS10010", "COMS2XXXX"]
}
\end{lstlisting}
\end{minipage}


JSON is cooler than XML in some aspects because:
\begin{enumerate}
    \item JSON doesn't use end tags
    \item JSON is shorter
    \item JSON is quicker to read and write
    \item JSON can use arrays
    \item And probably the biggest difference is that XML has to be parsed
        with an XML parser, while JSON can be parsed by a standard JS
        function, or in Java by the GSON library.
\end{enumerate}

Gson is cool in it's own right, but it's not entirely relevant and I'm
lazy, so I'll summarise to say that it's Google's answer to JSON.

\subsubsection{Templating}%
\label{ssub:Templating}
Templating is a method in which we can provide a template for a sentence
and then just fill in the necessary blanks with the required words. For
example:

\begin{lstlisting}[]
{
    "id":2,
    "name":"Bedminster",
    "electorate":9951,
    "x":135,
    "y":225
}


<p> The ${name} ward had an electorate of ${electorate} in ... </p>
\end{lstlisting}

The output of this would be: `The \textit{Bedminster} ward had an
electorate of \textit{9951} 9951 in ... '.

Free marker is a templating library, and it is a Java library that
generates text output (such as HTML web pages, e-mails, etc) based on the
templates and changing data. Templates are written in a simple,
specialised language called `FreeMarker Template Language' (FTL). A
general purpose programming language such as Java is used to prepare the
data, and then Apache FreeMarker displays this data using the templates.

\begin{minipage}{\textwidth}

Here's an example of some FreeMarker code:

\begin{lstlisting}[]
<#include "header"> <!--include other templates-->
<#if name??> <!-- condidionally display the elements-->
    <p> Hello, ${name}</p>
</if>
<#list messages as m>
    <p>${m.type}: ${m.text}</p>
</#list> <!--create some output for each element in a list-->
\end{lstlisting}
\end{minipage}

And this is the extent of the Web! Hope you enjoyed! xoxo

\section{Relational Databases}%
\label{sec:databases}

In databases, we have a three tier architecture setup. Firstly, we have
the \textbf{client}, which is the presentation layer. This is normally
made of things like HTML, CSS, JavaScript etc. After this, we have the
Application server. This is the \textbf{business logic layer}, and is
normally coded in Java. Finally, we have the database server, called the
data services layer. This is usually managed with a \textbf{DMS} (or
database management system).

Databases are really good because although CSVs are good for storing small
amounts of data that doesn't need to change often, it doesn't really scale
up. If there are large amounts of data that frequently change, AND it
needs to have it's integrity at all times, they're not suited to the job.

An example of this is with Bristol University. Say we had to write a
program to count the number of books with a title containing the word
`research'. Also suppose that all of the book records are stored in a text
file on a disk. How long would it take us to get through it?

If us, as a mere human, were to go through this, it would probably take
us about 7 months to get through the lot of it (if it wasn't ordered). So,
we need some algorithm and data structure for applications that want to
store such ridiculously large data structures. And database systems are
just the answer we're looking for.

Let's look at another example. Bank accounts need to store all of the
customers bank balances in a file on a disk. So we can write a program to
handle the ATM transactions, such as `debit £30 from account 024858'. If,
for some reason, it's a shared account, and I withdraw 10 pounds from the
account 1 second before my friend (who wants to withdraw £100), then the
following events would occur:

\begin{enumerate}
    \item The bank would read the balance from my request and return £1000
    \item The bank would read the balance from my friend's request and
        also return £1000
    \item 1000 is more than 10, and also more than 100, so the
        transaction can continue.
    \item My friend is closer to the account, so his ATM writes the
        balance back to the bank first, with the updated balance being
        900.
    \item My ATM performs the operation 1000-10 to be the new balance, and
        writes this back to the bank.
    \item My balance is now 990 despite me having taken out a total of 110
        pounds
\end{enumerate}

This is obviously not something that we want to be happening on a regular
occasion, so we need some special protocols to be implemented if the data
is going to be manipulated by multiple users concurrently. Again, database
systems are the answer to this.

The final example we are going to look at is when we bank transfer
someone. If we take a simple program as an example, when we transfer £100
to someone, for a split second, the money has vanished, because it has
been taken out of my account, and is going to be transferred into my
friend's. If the system were to crash at this precise moment, what would
happen to the "vanished" money? Data with strong integrity requirements
should probably be managed by a database.

\subsection{Tables}%
\label{sub:Tables}

A table in a database might look something like this:

\begin{center}
    \begin{tabular}{c|c|c|c}
        house & street & town & postcode \\
        \hhline{=|=|=|=}
        3 & Merton Street & Oxford & OX1 4JD \\
        \hline
        22 & Ambrose Street & York & YO1 3PQ \\
        \hline
        3a & Victoria Road & Malvern & WR14 1UB \\
        \hline
        21 & Woodland Road & Bristol & BS8 1UB \\
        \hline
        23 & Woodland Road & Bristol & BS8 1UB \\
    \end{tabular}
\end{center}

The \textbf{schema} for this table would be `Address(house, street, town,
postcode). 

\subsubsection{Keys}%
\label{ssub:Keys}

To address the data in the table, we use something called \textit{keys}.
We have two different kinds of key in databases:
\begin{itemize}
    \item \textbf{Superkey} -- a combination of fields that uniquely
        determines a row. 
        \begin{itemize}
            \item This  means that after choosing data for the
                fields in the superkey, we have \textit{no choice} over the rest
                of the data in that row.
            \item In the table above, `\{house, postcode\}' would be a
                superkey.
            \item If we fix data for \textit{house} and \textit{postcode},
                then street and town are determined, so there's no choice
                for this data.
            \item \{countryName\} would be a superkey for the schema
                `Countries(countryName, capitalCity, continent)', while
                \{continent\} would not be.
        \end{itemize}
    \item \textbf{Candidate key} -- also just called a key. It's a
        superkey that's also minimal.
        \begin{itemize}
            \item This means that if you remove any field from a key, it
                ceases to be a superkey.
            \item For example, in the address schema, \{house, postcode\}
                is a key, while \{postcode\}, \{house, postcode, street\}
                is NOT a key.
        \end{itemize}
\end{itemize}

\subsection{SQL}%
\label{sub:SQL}
Here are some quick facts about the SQL language:
\begin{itemize}
    \item It is not necessary to populate all fields (depending on the
        table definition of course).
    \item Strings are `single quoted'.
    \item Table constraints are a way of asking the DBMS nicely to
        guarantee the \textit{integrity} of your data.
\end{itemize}

\subsubsection{Constraints}%
\label{ssub:Constraints}
Constraints are useful because your DBMS doesn't know anything about the
thing you're writing your database about, so it can't know what needs to
be really strictly monitored. This is what a constraint looks like:

\begin{lstlisting}[]
CONSTRAINT key-constr UNIQUE (name, street, town)
\end{lstlisting}

The `key-constr' is a name to be used in error messages, and the `unique'
part tells the DBMS what a key is. For example, if we run this:

\begin{lstlisting}[language=SQL]
INSERT INTO BankBranches
    VALUES ('HSBC', 'Queens St', Bristol, '22-11-12');
INSERT INTO BankBranches
    VALUES ('HSBC', 'Queens St', 'Bristol', '22-12-16');
\end{lstlisting}

Then we'd get an error because there's a duplicate entry for the key.

Each table needs to have \textit{exactly} one \textbf{primary key}. Other
than this, constraints are an opportunity for you to provide some more
information to the DBMS, and therefore it will be able to tell you when
you're being a complete dumbass.

You also can't drop tables that a table has some foreign key to, because
then the DBMS will get angry (if you set up the constraints right - again,
stops you from being stupid).

\begin{minipage}{\textwidth}
\subsection{Projection Selection and Null}%
\label{sub:projection}
This handy little table will show you the kind of similarities there are
between relational programming concepts and the imperative programming
ones:

\begin{center}
    \begin{tabular}{c|c}
        Imperative Programming Concepts & Relational Programming Concepts
        \\
        \hhline{=|=}
        Assignment & Projection \\
        Sequencing & Selection \\
        Conditional branching & Product \\
        Bounded iteration & Join \\
        Unbounded iteration & Aggregation
    \end{tabular}
\end{center}
\end{minipage}

\begin{minipage}{\textwidth}
\subsubsection{Projection}%
\label{ssub:projection}
If we had this table:

\begin{center}
    \begin{tabular}{c|c|c}
        x & y & z \\
        \hhline{=|=|=}
        1 & a & yes \\
        2 & b & no \\
        3 & c & no \\
        4 & d & yes
    \end{tabular}
\end{center}
\end{minipage}
If we were to do `project y,x', we'd end up with:

\begin{center}
    \begin{tabular}{c|c}
        y & x \\ \hhline{=|=}
        a & 1 \\
        b & 2 \\
        c & 3 \\
        d & 4
    \end{tabular}
\end{center}

We could also do something cool like ``project x+1, `hello'" to get:

\begin{center}
    \begin{tabular}{c|c}
        x+1 & hello \\ \hhline{=|=}
        2 & hello \\
        3 & hello \\
        4 & hello \\
        5 & hello \\
    \end{tabular}
\end{center}
\newpage

\subsubsection{Selection}%
\label{ssub:selection}
If we were to perform ``Select z = `Yes'", we'd get:

\begin{center}
    \begin{tabular}{c|c|c}
        x & y & z \\
        \hhline{=|=|=}
        1 & a & yes \\
        2 & b & no \\
        3 & c & no \\
        4 & d & yes
    \end{tabular}
    \quad \quad $\xRightarrow{\text{select z = `yes'}}$ \quad \quad
    \begin{tabular}{c|c|c}
        x & y & z \\ \hhline{=|=|=}
        1 & a & yes \\
        4 & d & yes
    \end{tabular}
\end{center}

We could also do something a bit fancy with selection like:

\begin{center}
    \begin{tabular}{c|c|c}
        x & y & z \\
        \hhline{=|=|=}
        1 & a & yes \\
        2 & b & no \\
        3 & c & no \\
        4 & d & yes
    \end{tabular}
    \quad \quad $\xRightarrow{\text{select z = `yes'} \ \wedge \ x>2}$
    \quad \quad
    \begin{tabular}{c|c|c}
        x & y & z \\ \hhline{=|=|=}
        4 & d & yes
    \end{tabular}
\end{center}

\subsubsection{Combining them together}%
\label{ssub:combining}
With the following table:

\begin{center}
    \begin{tabular}{c|l|c}
        id & \multicolumn{1}{|c|}{title} & cp \\ \hhline{=|=|=}
        1 & Databases & 10 \\
        2 & Web Technologies & 10 \\
        3 & Types of $\lambda$-Calculus & 10 \\
        4 & Overview of Computer Architecture & 20 \\
        5 & Programming in C & 30 \\
    \end{tabular}
\end{center}

And we want to build a table containing only the titles of units that have
20 credit points or more, we can do the following:

\begin{lstlisting}[language=SQL]
SELECT title FROM Unit WHERE cp >= 20
\end{lstlisting}

This would give us the necessary results.

\begin{minipage}{\textwidth}
Here are some more fancy instructions: 

\begin{center}
    \begin{tabular}{c|c|c}
        \multicolumn{3}{l}{\textbf{CWMarks}} \\
        \multicolumn{3}{c}{}
        \\
        student & CW1 & CW2 \\ \hhline{=|=|=}
        1 & 60 & 73 \\
        2 & 28 & 54 \\
        3 & 72 & 70
    \end{tabular}
\end{center}

\begin{lstlisting}[language=SQL]
SELECT student, CW1*0.6 + CW*0.4 AS average
    FROM CWMarks
    WHERE CW1*0.6 + CW2*0.4 >= 40
\end{lstlisting}
\end{minipage}

Results in:

\begin{center}
    \begin{tabular}{c|c}
        student & average \\ \hhline{=|=}
        1 & 65.2 \\
        3 & 71.2
    \end{tabular}
\end{center}

\subsubsection{NULL data}%
\label{ssub:NULL}

SQL treats NULL data as an absence of data, or a `I don't know'.
Typically, built in functions and operators return NULL when \textit{any}
of their inputs are NULL. For example:

\begin{itemize}
    \item \lstinline{3*NULL = NULL}
    \item \lstinline{CONCAT('hello',NULL) = NULL} 
    \item \lstinline{NULL > 8 = NULL} 
\end{itemize}

However, there are a couple of exceptions:

\begin{itemize}
    \item \lstinline{NULL is NULL = 1}
        \item \lstinline{NULL IS NOT NULL = 0} 
\end{itemize}

In general, always know if your data can be null, and if it cannot, then
declare the field as \lstinline[language=SQL]{NOT NULL}. If your data
\textit{can} be null, consider the \lstinline[language=SQL]{IS NULL} case
in your selections.

\subsection{Product and Join}%
\label{sub:product-join}

Let's say that there are two databases, unit and lecturer. If we wanted to
know who the unit director is for the databases unit, we currently don't
have a way of knowing this. So, what we do is, we can take the
\textbf{Cartesian product} of the two tables, which means that we get all
of the possible combinations of data, and after this, we remove the ones
that don't make sense.

There are two ways we can do this. Looking at the following example:

\begin{center}
    \begin{tabular}{|c|c|c|c|}
        \multicolumn{4}{c}{\textbf{Mage}} \\
        \multicolumn{4}{c}{} \\
        \hline
        \textbf{id} & \textbf{name} & \textbf{mage} & \textbf{spell} \\
        \hhline{|=|=|=|=|}
        1 & Harry & 1 & 1 \\ \hline
        1 & Harry & 1 & 2 \\ \hline
        2 & Hermione & 2 & 1 \\ \hline
    \end{tabular}
\end{center}

\begin{center}
    \begin{tabular}{|c|c|}
        \multicolumn{2}{c}{\textbf{Spell}} \\
        \multicolumn{2}{c}{} \\
        \hline
        \textbf{id} & \textbf{spell} \\ \hhline{|=|=|}
        1 & Expelliarmus \\ \hline
        2 & Lumos \\ \hline
    \end{tabular}
\end{center}

If we do the Join of Mage and Spell on id = Mage, then we get the
following:
\begin{center}
    \begin{tabular}{|c|c|c|c|c|c|}
        \hline
        \textbf{id} & \textbf{name} & \textbf{mage} & \textbf{spell} &
        \textbf{id} & \textbf{name} \\ \hhline{|=|=|=|=|=|=|}
        1 & Harry & 1 & 1 & 1 & Expelliarmus \\ \hline
        \color{red}\st{1} & \color{red}\st{Harry} & \color{red}\st{1} &
        \color{red}\st{1} & \color{red}\st{2} & \color{red}\st{Lumos} \\ \hline
        \color{red}\st{1} & \color{red}\st{Harry} & \color{red}\st{1} &
        \color{red}\st{2} & \color{red}\st{1} & \color{red}\st{Expelliarmus} \\ \hline
        1 & Harry & 1 & 1 & 2 & Lumos \\
        \hline
        2 & Hermione & 2 & 1 & 1 & Expelliarmus \\ \hline
        \color{red}\st{2} & \color{red}\st{Hermione} & \color{red}\st{2} & \color{red}\st{1} & \color{red}\st{2} & \color{red}\st{Lumos} \\ \hline

    \end{tabular}
\end{center}

The \lstinline[language=SQL]|Join| keyword glues tables together by using
their keys (normally).

\subsubsection{Select-From-Where}%
\label{ssub:Select-From-Where}
This query is an incredibly useful query, and forms as a skeleton for all
other queries. For example, if we wanted to find all of the lecturers in
the same group as anther person, when can do a `select from where' query
on tables that are joined together:

\begin{lstlisting}[language=SQL]
SELECT R.name
    FROM Lecturer L JOIN Lecturer R ON L.rgroup = R.rgroup
    WHERE L.name = 'Peter'
\end{lstlisting}

\begin{minipage}{\textwidth}
\subsubsection{Join variants}%
\label{ssub:variants-join}

There are a few variants of the join command, and we'll go over them here.

\begin{itemize}
    \item \textbf{Natural join} joins the tables on their \textit{common
        columns}.
    \item \textbf{Left join} is another kind of join, but I don't really
        know what it does.
    \item \textbf{Right join}
    \item \textbf{Inner join} is the normal join that we already know
    \item \textbf{Outer join} is called the full outer join
    \item \textbf{Cross join} is written `table1, table2'
\end{itemize}
\end{minipage}

\subsubsection{Set operations}%
\label{ssub:set-operations}
\begin{itemize}
    \item \lstinline|Query1 UNION ALL Query2| also called the \textit{bag
        union} 
    \item \lstinline|Query1 UNION Query2| 
    \item \lstinline|Query1 INTERSECT Query2| 
    \item \lstinline|Query1 EXCEPT Query2| 
\end{itemize}

Oh yeah don't forget about \textit{entity relationship diagrams} where the
* means that it's a primary key, and there are primary and foreign key
relationships.

\subsection{Aggregation and nested queries}%
\label{sub:aggregation}

Imagine we have a table of all the students in a course, and we want to
know the average grade of each of the students over all the units:

\begin{center}
    \begin{tabular}{|c|c|c|}
        \multicolumn{3}{c}{\textbf{Enrol}} \\
        \multicolumn{3}{c}{} \\
        \hline
        \textbf{Student} & \textbf{Unit} & \textbf{Grade} \\
        \hhline{|=|=|=|}
        200 & 100 & 60 \\ \hline
        200 & 101 & 50 \\ \hline
        201 & 100 & 70 \\ \hline
        201 & 101 & 60 \\ \hline
        201 & 102 & 80 \\ \hline
    \end{tabular}
\end{center}

How would we do this?

\begin{minipage}{\textwidth}
The first thing we can do is group by a certain value, for example the
student ID. But, what happens to the other values, that change? Well, this
is where aggregation comes in. We have a few options for what to do with
this list of values. For example, we can take an average, take the
maximum, etc. What we \textbf{can't} do is to have more cells overflowing.
We can also take two different columns as the grouping factor.
\end{minipage}

Adding to our trust `Select from where' skeleton, we can now add
\lstinline[language=SQL]|GROUP BY|, and now, we get something looking like this:

\begin{lstlisting}[language=SQL]
SELECT columns
FROM table
WHERE condition
GROUP BY keycolumn
\end{lstlisting}

It's important in SQL to list the key column in the columns if you want it
to appear in the output. For example, going back to the first table, if we
perform \lstinline[language=SQL]|SELECT student, AVG(grade) AS average FROM enrol GROUP BY student|, we'd get:

\begin{center}
    \begin{tabular}{|c|c|}
        \hline
        \textbf{Student} & \textbf{Average} \\ \hhline{|=|=|}
        200 & 55 \\ \hline
        201 & 70 \\ \hline
    \end{tabular}
\end{center}

Here's a cool list of all of a lot of the aggregation functions:

\begin{itemize}
    \item \lstinline[language=SQL]|MIN()| 
    \item \lstinline[language=SQL]|MAX()| 
    \item \lstinline[language=SQL]|AVG()| 
    \item \lstinline[language=SQL]|SUM()| 
    \item \lstinline[language=SQL]|COUNT()| 
    \item \lstinline[language=SQL]|COUNT(DISTINCT)| 
    \item \lstinline[language=SQL]|COUNT(*)| 
\end{itemize}

To avoid problems, each column specifier in the SELECT part should return
\textbf{at most} one value when it's evaluated on a group. This is 
\textit{guaranteed} if each column is either mentioned in the GROUP BY
clause, an aggregate function application, or a constant.

Another thing we can add is the \lstinline[language=SQL]|HAVING| keyword.
If we want to select from some table with 2 conditions, then this `having'
keyword allows us to use a second condition to further expand our query.
For example:

\begin{lstlisting}[language=SQL]
SELECT columns
    FROM table
    WHERE condition1
    GROUP BY key_column
    HAVING condition2
\end{lstlisting}

Oh, did you think we were done? NO, there's also the
\lstinline[language=SQL]|ORDER BY| key word which, weirdly, orders the
results. We cal also add on the DESC or the ASC filter to sort the results
in descending or ascending order respectively. And there's a
\lstinline[language=SQL]|LIMIT| keyword, that limits the results by the
number you give it.

\subsubsection{Nested Queries}%
\label{ssub:nested-queries}
In the following table, if we wanted to find all the lecturers in the same
research group as `Peter', how would we do it?

\begin{center}
    \begin{tabular}{|c|c|c|}
        \multicolumn{3}{c}{\textbf{Lecturer}} \\
        \multicolumn{3}{c}{} \\ \hline
        \textbf{ID} & \textbf{Name} & \textbf{Rgroup} \\ \hhline{|=|=|=|}
        1 & David & null \\ \hline
        2 & Steven & 80 \\ \hline
        3 & Janet & 83 \\ \hline
        4 & Nick & 80 \\ \hline
    \end{tabular}
\end{center}

The query would look something like this:

\begin{lstlisting}[language=SQL]
SELECT name
FROM Lecturer
WHERE rgroup = (
    SELECT rgroup
    FROM Lecturer
    WHERE name = 'Peter'
)
\end{lstlisting}

Another thing we could do is to find the titles of the units whose
director is in the hardware group:

\begin{lstlisting}[language=SQL]
SELECT title
FROM Unit
WHERE director IN (
    SELECT id
    FROM Lecturer JOIN Rgroup
        ON Lecturer.rgroup = Rgroup.id
    WHERE Rgroup.name = 'Hardware'
)
\end{lstlisting}

There are even more cool things that we can do with nested queries, like
get the deviation from he student's overall average for each unit grade:

\begin{lstlisting}[language=SQL]
SELECT Enrol.student, unit, grade - T.average
    FROM (
        SELECT student, AVG(grade) AS average
        FROM Enrol
        GROUP BY student
    ) AS T /* new table needs to be named */
    JOIN Enrol ON Enrol.student = T.student
\end{lstlisting}

As an additional note, if you're going to aggregate over the whole table,
don't use GROUP BY, use something like:

\begin{lstlisting}[language=SQL]
SELECT COUNT(name) FROM student
\end{lstlisting}

\subsection{Normalisation}%
\label{sub:Normalisation}
Oh boy! Normalisation! This is the process where your tables get into
shape. Tables that are in normal form are no longer plagued by certain
kinds of redundancy (bad) and dependency (bad). These things can cause all
kinds of anomalies when inserting, updating and deleting data.

\subsubsection{Functional dependencies}%
\label{ssub:functional-dependencies}

\begin{center}
    \begin{tabular}{c c c c c}
        \multicolumn{5}{c}{\textbf{Cities in the UK}} \\
        \multicolumn{5}{c}{} \\ \hline
        City & c\_pop & Region & r\_pop & Country \\ \hhline{=====}
        Bristol & 0.44M & SW & 5.2M & England \\ 
        Bath & 88.8K & SW & 5.2M & England \\ 
        Manchester & 0.52M & NW & 7M & England \\ \hline
    \end{tabular}
\end{center}

If you do this, you're an idiot. Why would you keep all of these region
and region data separate, when you could just reference it in another
table? You lend yourself vulnerable to \textbf{update anomalies} because
of the population of the SW region increases, you gotta update it in a
load of tables.

Also, you might get \textbf{insert anomalies}, which is because we can't
have a city that's not in a region, or have a region with no cities.

\textbf{Delete anomalies} are also bad because if we remove the last city
in a region, the region would cease to exist.

By definition, a functional dependency is an attribute (A) that depends on a
set of attributes (XS), just if the value of the attribute is uniquely
determined after fixing set attributes. We write the dependency as $XS
\rightarrow A$.

Look at the following table for an example:

\begin{center}
    \begin{tabular}{c c c}
        \multicolumn{3}{c}{\textbf{Lecturer}} \\
        \multicolumn{3}{c}{} \\ \hline
        *uname & fname & lname \\ \hhline{===}
        csxdb & David & Bernhard \\ \hline
        csxds & David & Smith \\ \hline
    \end{tabular}
\end{center}

\begin{minipage}{\textwidth}
We have the following dependencies:
\begin{itemize}
    \item \{uname\} $\rightarrow$ fname
    \item \{uname\} $\rightarrow$ lname
    \item \{uname, fname\} $\rightarrow$ fname
    \item \{uname\} $\rightarrow$ uname
    \item \{fname\} $\not \rightarrow$ lname
\end{itemize}
\end{minipage}

Some of these are \textit{trivial} because they are already in the set
they are said to be functionally dependent with.

Fixing these dependencies isn't too hard. If we know all of the functional
dependencies, we just pick them out, and slap them in another table with a
foreign key.

\subsubsection{First normal form}%
\label{ssub:Normal-Forms}

This is an example of a terrible table:

\begin{center}
    \textbf{Bad table} 

    \begin{tabular}{c c c}
        \hline
        name & username & units \\ \hhline{===}
        "David" & "csxdb" & "COMSM0016, COMS10010" \\
        "Alice" & "csxaw" & "" \\
        "John" & "csxjs" & "COMS20002" \\ \hline
    \end{tabular}
\end{center}

Let's go through the normalisation steps.

\begin{center}
    \begin{tabular}{c c}
        \multicolumn{2}{c}{\textbf{Lecturers}} \\
        \multicolumn{2}{c}{} \\ \hline
        
        name & *username \\ \hline
        David & csxdb \\
        Alice & csxaw \\
        John & csxjs \\ \hline
    \end{tabular}
    \quad \quad
    \begin{tabular}{c c}
        \multicolumn{2}{c}{\textbf{Units}} \\
        \multicolumn{2}{c}{} \\ \hline
        
        *unit & director \\ \hline
        COMSM0016 & csxdb \\ 
        COMS10010 & csxdb \\
        COMS20002 & csxjs \\ \hline
    \end{tabular}
\end{center}

Here, the username is the foreign key for the director part of the
Lecturers table. 

\begin{minipage}{\textwidth}
\subsubsection{Second normal form}%
\label{ssub:2nf}

\begin{tcolorbox}
    Definition: \textbf{key attribute}

    \bigskip

    An attribute is said to be a \textit{key attribute} if it is part of
    some (candidate key), otherwise it's a \textit{non-key attribute} 
\end{tcolorbox}

\bigskip

For a database to be in 2NF, we need:
\begin{itemize}
    \item The database to be in 1NF
    \item There are no dependencies where XS $\rightarrow$ A where A is a
        non-key attribute and
    \item XS is all key attributes but is not a superkey
\end{itemize}
\end{minipage}

This looks like:

\begin{center}
    \begin{tabular}{|l|c|c|}
        \hline
        \multicolumn{1}{|c|}{\textbf{*house}} & \textbf{*postcode} & 
        \textbf{city} \\ \hhline{|=|=|=|}
        MVB & BS8 1UB & Bristol \\ \hline
        Flat D.01 & BS8 4UN & Bristol \\ \hline
        Flat D.02 & BS8 4UN & Bristol \\ \hline
        House of Commons & SW1 0AA & London \\ \hline
        30 & EC3A 8BF & London \\ \hline
    \end{tabular}

    $\downarrow{\text{to 2NF}}$

    \begin{tabular}{|l|c|}
        \hline
        \textbf{*house} & \textbf{*postcode} \\ \hhline{|=|=|}
        MVB & BS8 1UB \\ \hline
        Flat D.01 & BS8 4UN \\ \hline
        Flat D.02 & BS8 4UN \\ \hline
        House of Commons & SW1 0AA \\ \hline
        30 & EC3A 8BF \\ \hline
    \end{tabular}
    \quad
    \begin{tabular}{|c|c|}
        \hline
        \textbf{*postcode} & \textbf{city} \\ \hhline{|=|=|}
        BS8 1UB & Bristol \\ \hline
        BS8 4UN & Bristol \\ \hline
        SW1 0AA & London \\ \hline
        EC3A 8BF & London \\ \hline
    \end{tabular}
\end{center}

\subsubsection{Third normal form and transitive dependencies}%
\label{ssub:3nf}


Transitive dependencies are where you have something like $A \rightarrow B
\rightarrow C$. For example, in this table:

\begin{center}
    \begin{tabular}{|l|c|c|}
        \hline
        \multicolumn{1}{|c|}{\textbf{*postcode}} & \textbf{city} &
        \textbf{region} \\ \hhline{|=|=|=|}
        BS8 1UB & Bristol & SW \\ \hline
        BS8 4UN & Bristol & SW \\ \hline
        SW1 0AA & London & L \\ \hline
        EC3A 8BF & London & L \\ \hline
    \end{tabular}
\end{center}

\begin{minipage}{\textwidth}
We have the dependency \{postcode\} $\rightarrow$ \{city\} $\rightarrow$
region. Therefore, for a schema to be in 3NF we need:
\begin{itemize}
    \item The schema to be in 2NF
    \item The schema to have no \textit{non-trivial} dependencies $XS
        \rightarrow A$ with:
        \begin{itemize}
            \item A is a non-key attribute
            \item XS contains a non-key attribute, but not a superkey
        \end{itemize}
\end{itemize}
\end{minipage}

From the table above, we end up with these two tables:

\begin{center}
    \begin{tabular}{|c|c|}
        \hline
        \multicolumn{1}{|c|}{\textbf{*postcode}} & \textbf{city} \\
        \hhline{|=|=|}
        BS8 1UB & Bristol \\ \hline
        BS8 4UN & Bristol \\ \hline
        SW1 0AA & London \\ \hline
        EC3A 8BF & London \\ \hline
    \end{tabular}
    \quad
    \begin{tabular}{|c|c|}
        \hline
        \multicolumn{1}{|c|}{\textbf{*city}} & \textbf{region} \\
        \hhline{|=|=|}
        Bristol & SW \\ \hline
        London & L \\ \hline
    \end{tabular}
\end{center}

\subsubsection{BCNF - Boyce Codd Normal Form (3.5NF)} 
\label{ssub:bcnf}

Just when you thought we had enough normal forms, here's another one. The
problem we currently have is the following:

\begin{center}
    \begin{tabular}{|c|c|c|}
        \hline
        \textbf{student} & \textbf{email} & \textbf{society} \\
        \hhline{|=|=|=|}
        bb16801 & bilbo@... & Cheese and Wine \\ \hline
        bb16801 & bilbo@... & Hoverboard \\ \hline
        mm16280 & mickey@... & Hoverboard \\ \hline
        cl16343 & calvin@... & Pantosoc \\ \hline
        ht16991 & hobbes@... & Pantosoc \\ \hline
    \end{tabular}
\end{center}

The functional dependencies are:
\begin{itemize}
    \item \{student\} $\rightarrow$ \{studnet\} which is trivial.
    \item \{student, society\} $\rightarrow$ \{email\} (LHS superkey)
    \item \{student\} $\rightarrow$ \{email\} which is the problem
\end{itemize}

A sensible schema that's in 3NF is normally also in BCNF because you need
some effort to not be. Basically, 3NF is in BCNF automatically unless it
contains at least two composite candidate keys that overlap. 

Every schema can be decomposed to 3NF in a way that is both
\textit{lossless} and \textit{dependency preserving} (which means that no
functional dependencies are removed). For BCNF and higher, this is no
longer the case. In general, we should normalise to 3NF unless there is a
really really good reason not to. Then, continue to BCNF if it's possible
and sensible.

\subsection{JDBC: SQL in Java}%
\label{sub: JDBC}

\end{document}
